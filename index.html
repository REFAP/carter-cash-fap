<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Exp√©ditions FAP - Carter Cash</title>
    <meta name="description" content="Interface de gestion des exp√©ditions FAP pour les magasins Carter Cash">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-in;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .main-card {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .config-banner {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 5px;
        }

        .config-banner strong {
            color: #1565C0;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
            font-size: 1.05em;
        }

        .required {
            color: #e74c3c;
        }

        select, input[type="text"], input[type="email"], input[type="number"], textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
            font-family: inherit;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .dimensions-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .dimensions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .input-group {
            position: relative;
        }

        .input-group input {
            padding-right: 45px;
        }

        .input-unit {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-weight: 600;
            pointer-events: none;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }

        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .info-box p {
            color: #856404;
            margin: 0;
        }

        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 30px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .btn-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-submit:active:not(:disabled) {
            transform: translateY(0);
        }

        .loading-spinner {
            display: none;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        .loading-spinner.active {
            display: block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .message {
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        .message.active {
            display: block;
        }

        .message.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .message.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            font-size: 0.9em;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
            
            .main-card {
                padding: 25px;
            }
            
            .dimensions-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Am√©lioration accessibilit√© */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì¶ Gestion des Exp√©ditions FAP</h1>
            <p class="subtitle">Interface de commande pour les magasins Carter Cash</p>
        </header>

        <div class="main-card">
            <div class="config-banner" id="configBanner">
                <strong>‚öôÔ∏è Configuration requise :</strong> 
                Configurez votre endpoint Formspree dans le code ou utilisez le formulaire de test ci-dessous.
                <br><small>Endpoint actuel : <code id="currentEndpoint">https://formspree.io/f/mqaypnpa</code></small>
            </div>

            <form id="expeditionForm" action="https://formspree.io/f/mqaypnpa" method="POST">
                <div class="form-section">
                    <div class="form-group">
                        <label for="_replyto">
                            Email de contact <span class="required">*</span>
                        </label>
                        <input 
                            type="email" 
                            id="_replyto" 
                            name="_replyto" 
                            required 
                            placeholder="votre.email@entreprise.com"
                            aria-required="true"
                        >
                    </div>

                    <div class="form-group">
                        <label for="magasin">
                            S√©lectionner le magasin Carter Cash <span class="required">*</span>
                        </label>
                        <select id="magasin" name="magasin" required aria-required="true">
                            <option value="">-- Choisir un magasin --</option>
                            <option value="Carter Cash Paris Nord">Carter Cash Paris Nord</option>
                            <option value="Carter Cash Lyon Est">Carter Cash Lyon Est</option>
                            <option value="Carter Cash Marseille">Carter Cash Marseille</option>
                            <option value="Carter Cash Toulouse">Carter Cash Toulouse</option>
                            <option value="Carter Cash Bordeaux">Carter Cash Bordeaux</option>
                            <option value="Carter Cash Lille">Carter Cash Lille</option>
                            <option value="Carter Cash Nantes">Carter Cash Nantes</option>
                            <option value="Carter Cash Strasbourg">Carter Cash Strasbourg</option>
                            <option value="Carter Cash Nice">Carter Cash Nice</option>
                            <option value="Carter Cash Rennes">Carter Cash Rennes</option>
                            <option value="Carter Cash Montpellier">Carter Cash Montpellier</option>
                            <option value="Carter Cash Orl√©ans">Carter Cash Orl√©ans</option>
                            <option value="Carter Cash Dijon">Carter Cash Dijon</option>
                            <option value="Carter Cash Reims">Carter Cash Reims</option>
                            <option value="Carter Cash Tours">Carter Cash Tours</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="reference">
                            R√©f√©rence commande <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="reference" 
                            name="reference" 
                            required 
                            placeholder="Ex: CMD-2024-001"
                            pattern="[A-Za-z0-9-]+"
                            aria-required="true"
                        >
                    </div>
                </div>

                <div class="dimensions-section">
                    <h3>üìè Informations sur les FAP</h3>
                    
                    <div class="dimensions-grid">
                        <div class="input-group">
                            <label for="longueur">Longueur</label>
                            <input 
                                type="number" 
                                id="longueur" 
                                name="longueur" 
                                step="0.01" 
                                min="0"
                                placeholder="120"
                            >
                            <span class="input-unit">cm</span>
                        </div>
                        
                        <div class="input-group">
                            <label for="largeur">Largeur</label>
                            <input 
                                type="number" 
                                id="largeur" 
                                name="largeur" 
                                step="0.01"
                                min="0" 
                                placeholder="80"
                            >
                            <span class="input-unit">cm</span>
                        </div>
                        
                        <div class="input-group">
                            <label for="hauteur">Hauteur</label>
                            <input 
                                type="number" 
                                id="hauteur" 
                                name="hauteur" 
                                step="0.01"
                                min="0" 
                                placeholder="60"
                            >
                            <span class="input-unit">cm</span>
                        </div>
                        
                        <div class="input-group">
                            <label for="poids">Poids</label>
                            <input 
                                type="number" 
                                id="poids" 
                                name="poids" 
                                step="0.01"
                                min="0" 
                                placeholder="25"
                            >
                            <span class="input-unit">kg</span>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label for="quantite">
                            Quantit√© de FAP <span class="required">*</span>
                        </label>
                        <input 
                            type="number" 
                            id="quantite" 
                            name="quantite" 
                            required 
                            min="1" 
                            value="1"
                            aria-required="true"
                        >
                    </div>
                </div>

                <div class="info-box">
                    <p>
                        <strong>üìé Pour les documents :</strong> 
                        Utilisez un service de partage (WeTransfer, Google Drive, Dropbox) 
                        et ajoutez le lien dans les notes ci-dessous.
                    </p>
                </div>

                <div class="form-group">
                    <label for="notes">
                        Notes compl√©mentaires / Liens vers documents
                    </label>
                    <textarea 
                        id="notes" 
                        name="notes" 
                        placeholder="Informations suppl√©mentaires pour l'exp√©dition...&#10;Lien WeTransfer : &#10;Lien Google Drive : &#10;Autres remarques : "
                    ></textarea>
                </div>

                <!-- Champs cach√©s pour Formspree -->
                <input type="hidden" name="_subject" value="Nouvelle commande FAP Carter Cash">
                <input type="hidden" name="_template" value="table">
                <input type="text" name="_gotcha" style="display:none">

                <button type="submit" class="btn-submit" id="submitBtn">
                    Envoyer la demande d'exp√©dition
                </button>

                <div class="loading-spinner" id="loadingSpinner"></div>
                
                <div class="message success" id="successMessage">
                    ‚úÖ Votre demande a √©t√© envoy√©e avec succ√®s ! Nous la traiterons dans les plus brefs d√©lais.
                </div>
                
                <div class="message error" id="errorMessage">
                    ‚ùå Une erreur s'est produite. Veuillez r√©essayer ou nous contacter directement.
                </div>
            </form>
        </div>

        <footer>
            <p>¬© 2024 Carter Cash FAP - Syst√®me de gestion des exp√©ditions</p>
        </footer>
    </div>

    <script>
        // Configuration de base
        const CONFIG = {
            formspreeEndpoint: 'https://formspree.io/f/mqaypnpa', // √Ä remplacer
            resetDelay: 5000
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('expeditionForm');
            const submitBtn = document.getElementById('submitBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const currentEndpoint = document.getElementById('currentEndpoint');

            // Mise √† jour de l'affichage de l'endpoint
            if (currentEndpoint) {
                currentEndpoint.textContent = form.action;
            }

            // V√©rification de la configuration
            if (form.action.includes('mqaypnpa')) {
                console.warn('‚ö†Ô∏è N\'oubliez pas de configurer votre endpoint Formspree !');
            }

            // Gestion de la soumission du formulaire
            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                // R√©initialiser les messages
                successMessage.classList.remove('active');
                errorMessage.classList.remove('active');

                // D√©sactiver le bouton et afficher le spinner
                submitBtn.disabled = true;
                loadingSpinner.classList.add('active');

                try {
                    // Cr√©er FormData
                    const formData = new FormData(form);
                    
                    // Ajouter la date d'envoi
                    formData.append('date_envoi', new Date().toLocaleString('fr-FR'));

                    // Envoyer via Formspree
                    const response = await fetch(form.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });

                    if (response.ok) {
                        // Succ√®s
                        loadingSpinner.classList.remove('active');
                        successMessage.classList.add('active');
                        
                        // Sauvegarder dans localStorage pour historique
                        saveToHistory(formData);
                        
                        // R√©initialiser le formulaire apr√®s d√©lai
                        setTimeout(() => {
                            form.reset();
                            successMessage.classList.remove('active');
                            submitBtn.disabled = false;
                        }, CONFIG.resetDelay);
                    } else {
                        throw new Error('Erreur serveur');
                    }
                } catch (error) {
                    console.error('Erreur:', error);
                    loadingSpinner.classList.remove('active');
                    errorMessage.classList.add('active');
                    submitBtn.disabled = false;

                    setTimeout(() => {
                        errorMessage.classList.remove('active');
                    }, CONFIG.resetDelay);
                }
            });

            // Fonction pour sauvegarder dans l'historique local
            function saveToHistory(formData) {
                try {
                    const history = JSON.parse(localStorage.getItem('carterCashHistory') || '[]');
                    const entry = {};
                    
                    for (let [key, value] of formData.entries()) {
                        if (!key.startsWith('_')) {
                            entry[key] = value;
                        }
                    }
                    
                    entry.timestamp = new Date().toISOString();
                    history.push(entry);
                    
                    // Garder seulement les 50 derni√®res entr√©es
                    if (history.length > 50) {
                        history.shift();
                    }
                    
                    localStorage.setItem('carterCashHistory', JSON.stringify(history));
                } catch (e) {
                    console.log('Impossible de sauvegarder l\'historique local');
                }
            }

            // Validation am√©lior√©e
            const referenceInput = document.getElementById('reference');
            referenceInput.addEventListener('input', function() {
                this.value = this.value.toUpperCase();
            });

            // Auto-save des donn√©es du formulaire
            let autoSaveTimer;
            form.addEventListener('input', function() {
                clearTimeout(autoSaveTimer);
                autoSaveTimer = setTimeout(() => {
                    const formData = new FormData(form);
                    const data = {};
                    for (let [key, value] of formData.entries()) {
                        if (!key.startsWith('_')) {
                            data[key] = value;
                        }
                    }
                    localStorage.setItem('carterCashDraft', JSON.stringify(data));
                }, 1000);
            });

            // Restaurer le brouillon s'il existe
            const draft = localStorage.getItem('carterCashDraft');
            if (draft) {
                const data = JSON.parse(draft);
                const restore = confirm('Un brouillon a √©t√© trouv√©. Voulez-vous le restaurer ?');
                if (restore) {
                    Object.keys(data).forEach(key => {
                        const field = form.elements[key];
                        if (field) {
                            field.value = data[key];
                        }
                    });
                } else {
                    localStorage.removeItem('carterCashDraft');
                }
            }
        });

        // Message de confirmation avant de quitter si formulaire rempli
        window.addEventListener('beforeunload', function(e) {
            const form = document.getElementById('expeditionForm');
            const hasData = Array.from(form.elements).some(field => 
                field.value && field.type !== 'hidden' && field.type !== 'submit'
            );
            
            if (hasData && !document.querySelector('.message.success.active')) {
                e.preventDefault();
                e.returnValue = 'Des donn√©es non envoy√©es seront perdues.';
            }
        });
    </script>
</body>
</html>
